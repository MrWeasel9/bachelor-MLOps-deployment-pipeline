# services/mlflow/mlflow.yaml
# ... (apiVersion, kind, metadata, etc. are unchanged) ...
spec:
  containers:
  - name: mlflow
    image: bitnami/mlflow:2.22.0-debian-12-r5
    imagePullPolicy: IfNotPresent
    command:
      - sh
      - -c
      - |
        mlflow server \
          --host 0.0.0.0 \
          --port 5000 \
          --backend-store-uri "postgresql://mlflow:${POSTGRES_PASSWORD}@postgresql:5432/mlflow" \
          --default-artifact-root "s3://minio/mlflow-artifacts"
    ports:
    - containerPort: 5000
    env:
    - name: POSTGRES_PASSWORD
      valueFrom:
        secretKeyRef:
          name: postgresql
          key: postgres-password
    # ADD THIS NEW ENV VARIABLE
    - name: MLFLOW_S3_ENDPOINT_URL
      value: "http://minio:9000" # Points to the MinIO service within the cluster
    # CHANGE minio-credentials TO aws-s3-credentials for clarity
    envFrom:
    - secretRef:
        name: aws-s3-credentials # Changed for clarity, matches new secret name